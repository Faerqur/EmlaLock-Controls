<html>
<head>
<title>EmlaLock Countdown</title>
<link href="countdown.css" rel="stylesheet">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="TimeCircles.js"></script>
<link href="TimeCircles.css" rel="stylesheet">
<script type="text/javascript" src="pSBC.js"></script>
<script type="text/javascript" src="common.js"></script>
<script type="text/javascript">
'use strict'

const URL = 'https://www.emlalock.com/plugin/counter'
const URL_IMG = 'https://www.emlalock.com/images/profile/'

let COUNTDOWN
let AVATAR = false

const DEFAULT_SETTINGS = {
    userid: null,
    primary: '#7700bcff',
    primary_var: '#7700bc30',
    secondary: '#eeeeeea0',
    secondary_var: '#eeeeee',
    bgcolor: '#000000c0',
    bgimage: 'nice.jpg'
}

$(function() {
    loadQueryString()
    loadSettings(DEFAULT_SETTINGS)
    calculateTheme($.SETTINGS)
    setTheme($.THEME)
    setTitle($.SETTINGS.name)

    function makeVisible() {
        if(nonEmpty($.SETTINGS.userid)) {
            $('#countdown').css('display', 'flex')
        } else {
            $('#countdown').css('display', 'none')
        }

        if(nonEmpty($.SETTINGS.userid) && AVATAR) {
            $('#profile').css('display', 'block')
        } else {
            $('#profile').css('display', 'none')
        }
    }

    function load() {
        const img = URL_IMG + $.SETTINGS.userid + '.jpg'
        $.ajax({url: img, type: 'HEAD',
            success: function () {
                $('#avatar').attr('src', img)
                AVATAR = true
                makeVisible()
            }
        })
        reloadCountdown()
    }

    load()
    $(window).resize(function () {
        COUNTDOWN.rebuild()
    })
    setInterval(reloadCountdown, 60*1000)
    makeVisible()
})
</script>
</head>
<body>
  <div id="field">
    <div id="profile">
      <img id="avatar" alt="Avatar"/><br />
      <span id="username"></span>
    </div>
    <div id="countdown">
      <div id="face"></div>
    </div>
  </div>
</body>
</html>
